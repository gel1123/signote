<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/nord.min.css" integrity="sha512-igI4zzTHEU3IASS/ojMD7tO6hScqpnEnz41u+xVRNZvZEaF3XaCdre0qZ08frR1hri9+aSNeAXlQz1DS3luvxA==" crossorigin="anonymous" />
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/agate.min.css"> -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/purebasic.min.css" integrity="sha512-5ms/H4/ZHyMU0X3UWrz9cAOOwk/5l5kMf7CAYqjJpGBYLCiX9BhlO3r65PZ0jgitufFP5oa+Ly6RD8dI5gDilQ==" crossorigin="anonymous" /> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.13.0/beautify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.13.0/beautify-css.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.13.0/beautify-html.js"></script>

<style>
textarea {
	height: 150px;
	width: 100%;
}
.err {
	color: red;
}
#studying-canvas>textarea {
	height: 200px;
	width: 100%
}
</style>
<script>
'use strict';

const beautify_opt1 = { indent_size: 4, space_in_empty_paren: true }

const beautify_opt2 = {
  "indent_size": "1",
  "indent_char": "\t",
  "max_preserve_newlines": "5",
  "preserve_newlines": true,
  "keep_array_indentation": false,
  "break_chained_methods": false,
  "indent_scripts": "normal",
  "brace_style": "collapse",
  "space_before_conditional": true,
  "unescape_strings": false,
  "jslint_happy": false,
  "end_with_newline": false,
  "wrap_line_length": "0",
  "indent_inner_html": false,
  "comma_first": false,
  "e4x": false,
  "indent_empty_lines": false
}

document.addEventListener('keydown', (e)=> {
	const ke = document.querySelector('#keyboard-eve');
	const event_name = e.__proto__.toString().match(/[a-z-A-Z]+/g)[1];
	ke.querySelector('li>span').textContent = event_name;
	ke.querySelector('li+li>span').textContent = e.code;
	ke.querySelector('li+li+li>span').textContent = e.key;
})

const test = (self) => {

	document.querySelector('#yourcode').textContent = js_beautify(self.value, beautify_opt1);
	hljs.highlightBlock(document.querySelector('#yourcode'));
	
	try {
		const result = Function(
			'"use strict"; return (' 
			+ self.value
			+ ')'
		)();
		console.log(result);
		document.querySelector('#result>p').textContent = result;
	} catch(e) {
		console.error(e);
		document.querySelector('#result>p').innerHTML = '<div class="err"><strong>▼ 例外をキャッチしました</strong><br>'+e+'</div>';
	}
}
window.onload = () => {
	const event = new Event('input');
	[
		document.querySelector('#code>textarea'),
		document.forms.html_beautify_form.html_beautify_input,
		document.forms.css_beautify_form.css_beautify_input,
		document.querySelector('#studying-canvas>textarea')
	].forEach((elm) => elm.dispatchEvent(new Event('input')));
}
</script>
</head>
<body>
<form id="code">
	<h2>▼ JavaScriptのコードを試し書きできます ※strictモード</h2>
	<textarea oninput="test(this)">
(() => {

  var stateObj = { key1: "val1" };
  history.replaceState(stateObj, "title", "dummy");
  return JSON.stringify(history.state)

})()</textarea>
	<pre><code class="javascript" id="yourcode">
	</code></pre>
</form>
<div id="result">
	<h2>コードの実行結果</h2>
	<p></p>
</div>
<div id="keyboard-eve">
	<h2>発生したキーボードイベント</h2>
	<ul>
		<li>イベントのプロトタイプ名: <span></span> </li>
		<li>codeプロパティ: <span></span></li>
		<li>keyプロパティ: <span></span></li>
	</ul>
</div>

<div id="beautify">
	<h2>HTML, CSS整形</h2>
	<form id="html_beautify" name="html_beautify_form">
		<h3>HTML整形</h3>
		<textarea name="html_beautify_input" oninput="
			const target = document.forms.html_beautify_form.querySelector('code');
			target.textContent = html_beautify(this.value, beautify_opt2);
			hljs.highlightBlock(target)
		"><div><ul><li class="hoge">hoge</li></ul></div></textarea>
		<pre><code class="html"></code></pre>
	</form>

	<form id="css_beautify" name="css_beautify_form">
		<h3>CSS整形</h3>
		<textarea name="css_beautify_input" oninput="
			const target = document.forms.css_beautify_form.querySelector('code');
			target.textContent = css_beautify(this.value, beautify_opt2);
			hljs.highlightBlock(target)
		">.hoge { background: red; margin: 0 auto; text-align: center; }</textarea>
		<pre><code class="css"></code></pre>
	</form>
</div>
<div id="studying-canvas">
	<h2>canvas試し書き</h2>
	<textarea oninput="Function(this.value)();">
const canvas = document.querySelector("#canvas1");
const context = canvas.getContext("2d");
context.clearRect(0, 0, canvas.width, canvas.height);
context.font = "40px sans-serif";
context.setTransform(
	1, 	// 1. x軸の拡大率
	0.5, 	// 2. x軸の傾斜率
	0, 	// 3. y軸の拡大率
	1, 	// 4. y軸の傾斜率
	0, 	// 5. x軸の移動距離
	0	// 6. y軸の移動距離
);
context.fillText("TEST", 50, 50);</textarea>
	<canvas id="canvas1"></canvas>
</div>
</body>
</html>

